<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/member_style.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=KoPubWorldDotum:wght@500;700&display=swap" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



</head>

<body>

    <div class="div">
        <div class="background">
            <div class="background1">
            </div>
            <img class="menu-icon" alt="" src="{% static 'images/Menu.svg' %}">
            
            
            <div class="logo">
                <div class="logo-child">
                </div>
                <img class="logoo-icon" alt="" src="{% static 'images/Logoo.png' %}">
            
            </div>
        </div>
        <div class="child">
        </div>

        <div class="rect_blue"> </div>
        <div class="t"></div>


        <div class="rectangle-parent">
            <div class="group-child">
            </div>
            <div class="div22">
                <div class="title">
                    <b class="b8">국회의원 상세 정보</b>
                </div>
                <div class="div23">
                    <b class="b9">선거구</b>
                    <b class="answer">{{ member.origin }}</b>
                    <div class="inner">
                    </div>
                    <b class="b10">소속위원회</b>
                    <b class="answer1">{{ member.committee }}</b>
                    <div class="line-div">
                    </div>
                    <b class="b11">당선 대수</b>
                    <b class="answer2">{{ member.unit }}</b>
                    <div class="child1">
                    </div>
                    <b class="b12">사무실 전화</b>
                    <b class="answer3">{{ member.phone }}</b>
                    <div class="child2">
                    </div>
                    <b class="b13">사무실 호실</b>
                    <b class="answer4">{{ member.assem_addr }}</b>
                    <div class="child3">
                    </div>
                    <b class="b14">개별 홈페이지</b>
                    <b class="answer5">{{ member.homepage }}</b>
                    <div class="child4">
                    </div>
                    <b class="b15">이메일</b>
                    <b class="answer6">{{ member.email }}</b>
                    <div class="child5">
                    </div>
                    <b class="b16">보좌관</b>
                    <b class="answer7">{{ member.staff }}</b>
                    <div class="child6">
                    </div>
                    <b class="b17">선임비서관</b>
                    <b class="answer8">{{ member.secretary }}</b>
                    <div class="child7">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="picture">
            <div class="profile-picture-parent">
                <div class="profile-picture">
                    <img src="{{ member.image_url }}" alt="{{ member.name }}" class="profile-picture">
                </div>
                <div class="name-wrapper">
                    <div class="name">
                    </div>
                </div>
                <div class="name-parent">
                    <div class="name1">
                    </div>
                    <div class="div1">{{ member.name }} ({{ member.hj_nm }})</div>
                </div>
                <div class="div2">{{ member.party }}</div>
            </div>

            <img class="picture-child" alt="" src="{% static 'images/Line_23.svg' %}">

        </div>


        <div class="div24">
            <div class="rectangle-div">
            </div>
            <div class="title1">
                <b class="b8">본회의 출석률</b>
        
        
                <div class="chart-container">
                    <canvas id="chart-1"></canvas>
                </div>
        
        
                <script>
                    const data = {{ attendance| safe }};
                    const ctx = document.getElementById('chart-1').getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['출석률', '기타 결석률', '무단결석률'],
                            datasets: [{
                                data: [data.출석률, data.기타결석률, data.무단결석률],
                                backgroundColor: [
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(204, 153, 255, 0.7)',
                                    'rgba(255, 99, 132, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(204, 153, 255, 1)',
                                    'rgba(255, 99, 132, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { position: 'bottom' },
                                title: { display: true, text: '{{ selected_unit }}대 국회 출석률' }
                            }
                        }
                    });
                </script>
        
            </div>
        
        
        
            <div class="unit-buttons">
                {% if "100020" in member.unit_cd|stringformat:"s" %}
                <a href="?unit=20">
                    <button class="unit-btn {% if selected_unit == '20' %}active{% endif %}">20대</button>
                </a>
                {% endif %}
        
                {% if "100021" in member.unit_cd|stringformat:"s" %}
                <a href="?unit=21">
                    <button class="unit-btn {% if selected_unit == '21' %}active{% endif %}">21대</button>
                </a>
                {% endif %}
        
                {% if member.phone or "100022" in member.unit_cd|stringformat:"s" %}
                <a href="?unit=22">
                    <button class="unit-btn {% if selected_unit == '22' %}active{% endif %}">22대</button>
                </a>
                {% endif %}
            </div>
        
        </div>




        <div class="search-bar">
            <div class="div3" contenteditable="true" spellcheck="false" data-placeholder="다른 의원 정보 검색"></div>
            <img class="frame-icon" alt="" src="{% static 'images/Vector.svg' %}">

            <img class="vector-icon" alt="검색" src="{% static 'images/Frame.svg' %}">

        </div>

        <div class="div4">
            <b class="b">본회의 표결정보</b>


            <div class="div5">
                <b class="b1">연번</b>
                <b class="b1">대수</b>
                <b class="b1">의결일자</b>
                <b class="b1">의안명</b>
                <b class="b5">소관위원회</b>
                <b class="b5">표결정보</b>
                <b class="b5">표결결과</b>
                <img class="item" alt="" src="Line 15.svg">

            </div>
            {% for vote in votes %}
            <div class="div6">
                <div class="div7">{{ forloop.counter0|add:offset|add:"1" }}</div>
                <div class="div7">제 {{ vote.bill.age }}대</div>
                <div class="div7">{{ vote.bill.rgs_proc_dt }}</div>
                <div class="div7">{{ vote.bill.bill_name }}</div>
                <div class="div11">{{ vote.bill.committee }}</div>
                <div class="div11">{{ vote.vote_result }}</div>
                <div class="div11">{{ vote.bill.proc_result }}</div>
            </div>
            {% endfor %}





            <div class="pagination">
                {% if has_previous_group %}
                <a href="?page={{ previous_group_page }}" class="arrow-button">&laquo; 이전</a>
                {% endif %}
            
                {% for num in custom_page_range %}
                {% if num == votes.number %}
                <span class="page-button active">{{ num }}</span>
                {% else %}
                <a href="?page={{ num }}" class="page-button">{{ num }}</a>
                {% endif %}
                {% endfor %}
            
                {% if has_next_group %}
                <a href="?page={{ next_group_page }}" class="arrow-button">다음 &raquo;</a>
                {% endif %}      
            </div>

        </div>

        
        <div class="div25">
            <div class="child8">
            </div>
            <div class="div26">정당</div>
            <div class="div27">정당</div>
        </div>
    </div>






    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBox = document.querySelector('.div3');
            const vectorIcon = document.querySelector('.vector-icon');


            function submitSearch() {
                if (!searchBox) return;

                const query = searchBox.textContent.trim();

                if (!query) return;

                const params = new URLSearchParams({ q: query });

                window.location.href = `/?${params.toString()}`;
            }

            // ✅ vector-icon 클릭 이벤트
            if (vectorIcon) {
                console.log("vectorIcon:", vectorIcon);
                vectorIcon.addEventListener('click', () => {
                    console.log("벡터 아이콘 클릭됨");
                    submitSearch();
                });
            }

            // ✅ Enter 키 입력
            if (searchBox) {
                searchBox.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        submitSearch();
                    }
                });
            }

            // ✅ 검색창 placeholder 및 커서 처리
            function placeCaretAtEnd(el) {
                el.focus();
                const range = document.createRange();
                range.selectNodeContents(el);
                range.collapse(false);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }

            function activateEditing() {
                if (searchBox.textContent.trim() === '') {
                    searchBox.textContent = '';
                }
                searchBox.classList.add('editing');
                placeCaretAtEnd(searchBox);
            }

            searchBox.addEventListener('click', activateEditing);
            searchBox.addEventListener('focus', activateEditing);
            searchBox.addEventListener('input', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.innerHTML = '';
                    placeCaretAtEnd(searchBox);
                }
            });
            searchBox.addEventListener('blur', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.classList.remove('editing');
                    searchBox.textContent = '';
                }
            });
        });
    </script>


</body>

</html>