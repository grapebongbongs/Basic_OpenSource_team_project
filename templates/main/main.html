<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">

    {% load url_utils %}

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main_style.css' %}">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=DaeguCatholicUniversity:wght@400&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=KoPubWorldDotum:wght@500;700&display=swap" />



</head>

<body>

    {% load static %}
    <script src="{% static 'js/scripts.js' %}"></script>

    <div class="div">
        <div class="background">
            <div class="background-child">
                <div class="asona">ASONA</div>
            </div>
        </div>

        <div class="group">
        
            <div class="div5" data-unit="100020">20대</div>
            <div class="div5" data-unit="100021">21대</div>
            <div class="div5" data-unit="100022">22대</div>
        
        </div>

        <div class="parent">
            {% for m in members %}
            <div class="div1" data-mona-cd="{{ m.mona_cd }}">
                <div class="profile-pic">
                    <img src="{{ m.image_url }}" alt="{{ m.name }}" class="profile-pic">
                </div>
                <div class="ex1">
                </div>
                <b class="b">{{ m.name }}</b>
                <div class="ex11">
                </div>
                <b class="b1">{{ m.origin }}</b>
                <div class="ex12">
                </div>
                <b class="b2">{{ m.party }}</b>
                <div class="ex13">
                </div>
                <b class="b3">{{ m.committee }}</b>
            </div>

            {% empty %}
            <div class="no-data">데이터가 없습니다.</div>
            {% endfor %}


            <div class="pagination">
                {% querystring_without_page as qs %}
            
                {% if has_previous_group %}
                    <a href="?{{ qs }}&page={{ previous_group_page }}" class="arrow-button">&laquo; 이전</a>
                {% endif %}
            
                {% for num in custom_page_range %}
                    {% if num == members.number %}
                        <span class="page-button active">{{ num }}</span>
                    {% else %}
                        <a href="?{{ qs }}&page={{ num }}" class="page-button">{{ num }}</a>
                    {% endif %}
                {% endfor %}
            
                {% if has_next_group %}
                    <a href="?{{ qs }}&page={{ next_group_page }}" class="arrow-button">다음 &raquo;</a>
                {% endif %}      
            </div>

            
        </div>

        <img class="menu-icon" alt="" src="{% static 'images/Menu.svg' %}">

        <div class="search-bar">
            <div class="test" contenteditable="true" spellcheck="false" data-placeholder="search"></div>
            <img class="frame-icon" alt="" src="{% static 'images/Vector.svg' %}">

            <img class="vector-icon" alt="검색" src="{% static 'images/Frame.svg' %}">

        </div>

        <div class="logo">
            <div class="logo-child">
            </div>
            <img class="logoo-icon" alt="" src="{% static 'images/Logoo.png' %}">

        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBox = document.querySelector('.test');
            const vectorIcon = document.querySelector('.vector-icon');
            const unitButtons = document.querySelectorAll('.div5');

            function getCurrentUnitCd() {
                const selectedBtn = document.querySelector('.div5.selected');
                return selectedBtn ? selectedBtn.getAttribute('data-unit') : null;
            }

            function submitSearch() {
                if (!searchBox) return;

                const query = searchBox.textContent.trim();
                const unit_cd = getCurrentUnitCd();

                if (!query) return;

                const params = new URLSearchParams({ q: query });
                if (unit_cd) {
                    params.set('unit_cd', unit_cd);
                }

                window.location.href = `/?${params.toString()}`;
            }

            // ✅ vector-icon 클릭 이벤트
            if (vectorIcon) {
                console.log("vectorIcon:", vectorIcon);
                vectorIcon.addEventListener('click', () => {
                    console.log("벡터 아이콘 클릭됨");
                    submitSearch();
                });
            }

            // ✅ Enter 키 입력
            if (searchBox) {
                searchBox.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        submitSearch();
                    }
                });
            }

            // ✅ unit_cd 버튼 선택 상태 유지 및 이동
            const selectedUnit = new URLSearchParams(window.location.search).get('unit_cd');
            unitButtons.forEach(btn => {
                const unitCd = btn.getAttribute('data-unit');
                if (unitCd === selectedUnit) {
                    btn.classList.add('selected');
                }
                btn.addEventListener('click', () => {
                    unitButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    window.location.href = `/?unit_cd=${unitCd}`;
                });
            });

            // ✅ 검색창 placeholder 및 커서 처리
            function placeCaretAtEnd(el) {
                el.focus();
                const range = document.createRange();
                range.selectNodeContents(el);
                range.collapse(false);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }

            function activateEditing() {
                if (searchBox.textContent.trim() === '') {
                    searchBox.textContent = '';
                }
                searchBox.classList.add('editing');
                placeCaretAtEnd(searchBox);
            }

            searchBox.addEventListener('click', activateEditing);
            searchBox.addEventListener('focus', activateEditing);
            searchBox.addEventListener('input', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.innerHTML = '';
                    placeCaretAtEnd(searchBox);
                }
            });
            searchBox.addEventListener('blur', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.classList.remove('editing');
                    searchBox.textContent = '';
                }
            });
        });
    </script>

</body>

</html>