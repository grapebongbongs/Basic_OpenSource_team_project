<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">

    <title>ë©”ì¸ í™ˆí˜ì´ì§€</title>

    {% load url_utils %}

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main_style.css' %}">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=DaeguCatholicUniversity:wght@400&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=KoPubWorldDotum:wght@500;700&display=swap" />

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const baseWidth = window.innerWidth;
            const baseHeight = window.innerHeight;
            document.documentElement.style.setProperty('--vw-base', `${baseWidth * 0.01}px`);
            document.documentElement.style.setProperty('--vh-base', `${baseHeight * 0.01}px`);
        });
    </script>

    <style>
        body {
            visibility: hidden;
        }
    </style>



</head>

<body>

    {% load static %}
    <script src="{% static 'js/scripts.js' %}"></script>

    <div class="div">
        <div class="background">
            <div class="menu-bar">
                <div class="menu_asona">ASONA</div>

                <div class="menu-right">
                    <a href="/" class="menu_b">í™ˆ í™”ë©´</a>
                    <a href="/api/map" class="menu_b">ì§€ë„</a>
                    <a href="/api/calendar" class="menu_b">ìº˜ë¦°ë”</a>
                </div>
            </div>

            <div class="background-child">
                <div class="asona">ASONA</div>
            </div>

        </div>

        <div class="group">

            <div class="div5" data-unit="100020">20ëŒ€</div>
            <div class="div5" data-unit="100021">21ëŒ€</div>
            <div class="div5" data-unit="100022">22ëŒ€</div>

        </div>

        <div class="parent">
            {% for m in members %}
            <div class="div1" data-mona-cd="{{ m.mona_cd }}">
                <div class="profile-pic">
                    <img src="{{ m.image_url }}" alt="{{ m.name }}" class="profile-pic">
                </div>
                <div class="ex1">
                    <b class="b">{{ m.name }}</b>
                </div>

                <div class="ex11">
                    <b class="b1">{{ m.origin }}</b>
                </div>

                <div class="ex12">
                    <b class="b2">{{ m.party }}</b>
                </div>

                <div class="ex13">
                    <b class="b3">{{ m.committee }}</b>
                </div>

            </div>

            {% empty %}
            <div class="no-data">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            {% endfor %}


            <div class="pagination">
                {% querystring_without_page as qs %}

                {% if has_previous_group %}
                <a href="?{{ qs }}&page={{ previous_group_page }}" class="arrow-button">&laquo; ì´ì „</a>
                {% endif %}

                {% for num in custom_page_range %}
                {% if num == members.number %}
                <span class="page-button active">{{ num }}</span>
                {% else %}
                <a href="?{{ qs }}&page={{ num }}" class="page-button">{{ num }}</a>
                {% endif %}
                {% endfor %}

                {% if has_next_group %}
                <a href="?{{ qs }}&page={{ next_group_page }}" class="arrow-button">ë‹¤ìŒ &raquo;</a>
                {% endif %}
            </div>


        </div>

        <img class="menu-icon" alt="" src="{% static 'images/Menu.svg' %}">

        <div class="search-bar">
            <div class="test" contenteditable="true" spellcheck="false" data-placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></div>
            <img class="frame-icon" alt="" src="{% static 'images/Vector.svg' %}">

            <img class="vector-icon" alt="ê²€ìƒ‰" src="{% static 'images/Frame.svg' %}">

            <div id="slide-buttons" class="slide-button-container">
                <button class="slide-btn">ì„œìš¸</button>
                <button class="slide-btn">ì¸ì²œ</button>
                <button class="slide-btn">ì„¸ì¢…</button>
                <button class="slide-btn">ëŒ€ì „</button>
                <button class="slide-btn">ëŒ€êµ¬</button>
                <button class="slide-btn">ë¶€ì‚°</button>
                <button class="slide-btn">ìš¸ì‚°</button>
                <button class="slide-btn">ê´‘ì£¼</button>
                <button class="slide-btn">ê²½ê¸°</button>
                <button class="slide-btn">ê°•ì›</button>
                <button class="slide-btn">ì¶©ë¶</button>
                <button class="slide-btn">ì¶©ë‚¨</button>
                <button class="slide-btn">ì „ë¶</button>
                <button class="slide-btn">ì „ë‚¨</button>
                <button class="slide-btn">ê²½ë¶</button>
                <button class="slide-btn">ê²½ë‚¨</button>
                <button class="slide-btn">ì œì£¼</button>
                <button class="slide-btn">ëª¨ë‘</button>
            </div>

        </div>

        <div class="logo">
            <div class="logo-child">
            </div>
            <img class="logoo-icon" alt="" src="{% static 'images/Logoo.png' %}">

        </div>
    </div>


    <script>

        /* ğŸ‘‰ URL íŒŒë¼ë¯¸í„°ë¥¼ ìš°ì„ ìˆœìœ„(unit_cdâ†’distâ†’qâ†’page)ë¡œ ì¬ì¡°ë¦½ ---- */
        // â­  ìƒˆë¡œ ì¶”ê°€ëœ ê³µí†µ ìœ í‹¸ í•¨ìˆ˜
        function buildUrl(params) {
            const order = ['unit_cd', 'dist', 'q', 'page'];   // ìš°ì„ ìˆœìœ„
            const parts = [];
            order.forEach(key => {
                if (params.has(key) && params.get(key) !== '') {
                    parts.push(`${key}=${encodeURIComponent(params.get(key))}`);
                }
            });
            return '/?' + parts.join('&');
        }


        /* ------------------------------------------------------------------
           ê²€ìƒ‰ì°½, ë‹¨ì¼ unit_cd ë²„íŠ¼, ë©”ë‰´ í† ê¸€ ë“± ê¸°ì¡´ ê¸°ëŠ¥
        ------------------------------------------------------------------ */
        document.addEventListener('DOMContentLoaded', () => {
            const searchBox = document.querySelector('.test');
            const vectorIcon = document.querySelector('.vector-icon');
            const unitButtons = document.querySelectorAll('.div5');
            const params = new URLSearchParams(window.location.search);   // â­ ì¶”ê°€
            const initialQ = params.get('q')?.trim() || '';                // â­ ì¶”ê°€

            /* â”€â”€ (1) í˜ì´ì§€ ì²« ë¡œë“œ ì‹œ q íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            if (initialQ) {
                searchBox.textContent = initialQ;        // ê²€ìƒ‰ì–´ ìœ ì§€
                searchBox.classList.add('no-placeholder');  // placeholder ìˆ¨ê¹€
            } else {
                searchBox.textContent = '';              // placeholder ë³´ì´ë„ë¡ ë¹„ì›€
                searchBox.classList.remove('no-placeholder');
                searchBox.classList.remove('editing');
            }



            /* ğŸ‘‰ í˜„ì¬ ì„ íƒëœ unit_cd ë°˜í™˜ ---------------------------------- */
            function getCurrentUnitCd() {
                const selectedBtn = document.querySelector('.div5.selected');
                return selectedBtn ? selectedBtn.getAttribute('data-unit') : null;
            }




            /* ğŸ‘‰ ê²€ìƒ‰ ì œì¶œ ----------------------------------------------- */
            function submitSearch() {
                if (!searchBox) return;

                const query = searchBox.textContent.trim();
                if (!query) return;

                /* ê¸°ì¡´Â·í˜„ì¬ URL íŒŒë¼ë¯¸í„° ìˆ˜ì§‘ */
                const params = new URLSearchParams(window.location.search);

                /* unit_cdëŠ” ê·¸ëŒ€ë¡œ, distë„ ê·¸ëŒ€ë¡œ ë‘ê³  page ì´ˆê¸°í™” */
                params.delete('q');     // ê¸°ì¡´ q ì œê±°
                params.delete('page');  // í˜ì´ì§€ ì´ˆê¸°í™”
                params.set('q', query); // ìƒˆ ê²€ìƒ‰ì–´ ì‚½ì…

                /* ìµœì¢… URL ìƒì„± */
                window.location.href = buildUrl(params);  // â­ ìˆ˜ì •
            }

            /* vector-icon í´ë¦­ */
            if (vectorIcon) {
                vectorIcon.addEventListener('click', submitSearch);
            }

            /* Enter ì…ë ¥ */
            if (searchBox) {
                searchBox.addEventListener('keydown', e => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        submitSearch();
                    }
                });
            }

            /* unit_cd ë²„íŠ¼(20Â·21Â·22ëŒ€) ì²˜ë¦¬ ------------------------------ */
            const selectedUnit = new URLSearchParams(window.location.search).get('unit_cd');
            unitButtons.forEach(btn => {
                const unitCd = btn.getAttribute('data-unit');
                if (unitCd === selectedUnit) btn.classList.add('selected');

                btn.addEventListener('click', () => {
                    /* unit_cd í´ë¦­ ì‹œ selected í† ê¸€ */
                    unitButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');

                    const params = new URLSearchParams(window.location.search);
                    params.set('unit_cd', unitCd);  // ê°±ì‹ 
                    params.delete('page');          // í˜ì´ì§€ ì´ˆê¸°í™”
                    /* dist, q ìœ ì§€ */

                    window.location.href = buildUrl(params); // â­ ìˆ˜ì •
                });
            });

            /* ê²€ìƒ‰ì°½ placeholder ì²˜ë¦¬ (ê¸°ì¡´ ë¡œì§) ------------------------- */
            function placeCaretAtEnd(el) {
                el.focus();
                const range = document.createRange();
                range.selectNodeContents(el);
                range.collapse(false);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }
            function activateEditing() {
                if (searchBox.textContent.trim() === '') searchBox.textContent = '';
                searchBox.classList.add('editing');
                placeCaretAtEnd(searchBox);
            }
            searchBox.addEventListener('click', activateEditing);
            searchBox.addEventListener('focus', activateEditing);
            searchBox.addEventListener('input', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.innerHTML = '';
                    placeCaretAtEnd(searchBox);
                }
            });
            searchBox.addEventListener('blur', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.classList.remove('editing');
                    searchBox.textContent = '';
                }
            });
        });

        /* ------------------------------------------------------------------
           ë©”ë‰´ ì•„ì´ì½˜(í–„ë²„ê±°) í† ê¸€
        ------------------------------------------------------------------ */
        document.addEventListener('DOMContentLoaded', () => {
            const menuIcon = document.querySelector('.menu-icon');
            const menuBox = document.querySelector('.menu-bar');
            // const logoIcon = document.querySelector('.logo');

            if (menuIcon && menuBox) {
                menuIcon.addEventListener('click', () => {
                    menuBox.classList.toggle('show');
                    // logoIcon.classList.toggle('hidden');
                });
            }

            /* ------------------------------------------------------------------
           slide-btn í´ë¦­ â†’ dist(ì§€ì—­) íŒŒë¼ë¯¸í„° ì¶”ê°€
           ìš°ì„ ìˆœìœ„ : unit_cd > dist > q > page
        ------------------------------------------------------------------ */
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const distVal = button.textContent.trim();

                    const params = new URLSearchParams(window.location.search);
                    params.set('dist', distVal);  // â­ dist ê°±ì‹ 

                    /* âœ¨ ë³€ê²½ â‘  : â€˜ëª¨ë‘â€™(All) ë²„íŠ¼ì´ë©´ dist ì œê±°, ì•„ë‹ˆë©´ ì„¸íŒ… */
                    if (distVal === 'ëª¨ë‘') {      // ë²„íŠ¼ ê¸€ìë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ë§ì¶° ì£¼ì„¸ìš”
                        params.delete('dist');     // dist íŒŒë¼ë¯¸í„° ì™„ì „íˆ ì œê±°
                    }
                    else {
                        params.set('dist', distVal);
                    }

                    params.delete('page');        // í˜ì´ì§€ ì´ˆê¸°í™”

                    /* ìµœì¢… URL ì¡°ë¦½í•˜ì—¬ ì´ë™ */
                    window.location.href = buildUrl(params);  // â­ buildUrl ì‚¬ìš©
                });
            });

        });

        /* ------------------------------------------------------------------
           í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
        ------------------------------------------------------------------ */
        window.addEventListener('beforeunload', () => { window.scrollTo(0, 0); });
        window.addEventListener('load', () => { setTimeout(() => window.scrollTo(0, 0), 0); });

        /* ------------------------------------------------------------------
           frame-icon í´ë¦­ ì‹œ slide-btn ìˆœì°¨ ë“±ì¥
        ------------------------------------------------------------------ */
        const frameIcon = document.querySelector('.frame-icon');
        const buttons = document.querySelectorAll('.slide-btn');
        let buttonsVisible = false;
        let timeouts = [];

        frameIcon?.addEventListener('click', () => {
            /* ì¤‘ê°„ í´ë¦­ ì‹œ ê¸°ì¡´ íƒ€ì´ë¨¸ ì œê±° */
            timeouts.forEach(t => clearTimeout(t));
            timeouts = [];

            if (!buttonsVisible) {
                /* ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
                buttons.forEach((btn, idx) => {
                    const t = setTimeout(() => btn.classList.add('show'), idx * 50);
                    timeouts.push(t);
                });
            } else {
                /* ì¦‰ì‹œ ì‚¬ë¼ì§ */
                buttons.forEach(btn => btn.classList.remove('show'));
            }
            buttonsVisible = !buttonsVisible;
        });

    </script>



    <script>
        window.addEventListener('load', function () {
            document.body.style.visibility = 'visible';
        });
    </script>

</body>

</html>