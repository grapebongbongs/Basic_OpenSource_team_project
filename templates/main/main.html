<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width">

    {% load url_utils %}

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main_style.css' %}">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=DaeguCatholicUniversity:wght@400&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=KoPubWorldDotum:wght@500;700&display=swap" />

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const baseWidth = window.innerWidth;
            const baseHeight = window.innerHeight;
            document.documentElement.style.setProperty('--vw-base', `${baseWidth * 0.01}px`);
            document.documentElement.style.setProperty('--vh-base', `${baseHeight * 0.01}px`);
        });
    </script>
    
    <style>
        body {
            visibility: hidden;
        }
    </style>



</head>

<body>

    {% load static %}
    <script src="{% static 'js/scripts.js' %}"></script>

    <div class="div">
        <div class="background">
            <div class="menu-bar">
                <div class="menu_asona">ASONA</div>
            
                <div class="menu-right">
                    <a href="/" class="menu_b">Ìôà ÌôîÎ©¥</a>
                    <a href="/api/map" class="menu_b">ÏßÄÎèÑ</a>
                    <a href="/api/calendar" class="menu_b">Ï∫òÎ¶∞Îçî</a>
                </div>
            </div>

            <div class="background-child">
                <div class="asona">ASONA</div>
            </div>
            
        </div>

        <div class="group">
        
            <div class="div5" data-unit="100020">20ÎåÄ</div>
            <div class="div5" data-unit="100021">21ÎåÄ</div>
            <div class="div5" data-unit="100022">22ÎåÄ</div>
        
        </div>

        <div class="parent">
            {% for m in members %}
            <div class="div1" data-mona-cd="{{ m.mona_cd }}">
                <div class="profile-pic">
                    <img src="{{ m.image_url }}" alt="{{ m.name }}" class="profile-pic">
                </div>
                <div class="ex1">
                    <b class="b">{{ m.name }}</b>
                </div>

                <div class="ex11">
                    <b class="b1">{{ m.origin }}</b>
                </div>
                
                <div class="ex12">
                    <b class="b2">{{ m.party }}</b>
                </div>
                
                <div class="ex13">
                    <b class="b3">{{ m.committee }}</b>
                </div>
                
            </div>

            {% empty %}
            <div class="no-data">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
            {% endfor %}


            <div class="pagination">
                {% querystring_without_page as qs %}
            
                {% if has_previous_group %}
                    <a href="?{{ qs }}&page={{ previous_group_page }}" class="arrow-button">&laquo; Ïù¥Ï†Ñ</a>
                {% endif %}
            
                {% for num in custom_page_range %}
                    {% if num == members.number %}
                        <span class="page-button active">{{ num }}</span>
                    {% else %}
                        <a href="?{{ qs }}&page={{ num }}" class="page-button">{{ num }}</a>
                    {% endif %}
                {% endfor %}
            
                {% if has_next_group %}
                    <a href="?{{ qs }}&page={{ next_group_page }}" class="arrow-button">Îã§Ïùå &raquo;</a>
                {% endif %}      
            </div>

            
        </div>

        <img class="menu-icon" alt="" src="{% static 'images/Menu.svg' %}">

        <div class="search-bar">
            <div class="test" contenteditable="true" spellcheck="false" data-placeholder="search"></div>
            <img class="frame-icon" alt="" src="{% static 'images/Vector.svg' %}">

            <img class="vector-icon" alt="Í≤ÄÏÉâ" src="{% static 'images/Frame.svg' %}">

            <div id="slide-buttons" class="slide-button-container">
                <button class="slide-btn">ÏÑúÏö∏</button>
                <button class="slide-btn">Ïù∏Ï≤ú</button>  
                <button class="slide-btn">ÏÑ∏Ï¢Ö</button>
                <button class="slide-btn">ÎåÄÏ†Ñ</button>
                <button class="slide-btn">ÎåÄÍµ¨</button>
                <button class="slide-btn">Î∂ÄÏÇ∞</button>
                <button class="slide-btn">Ïö∏ÏÇ∞</button>
                <button class="slide-btn">Í¥ëÏ£º</button>
                <button class="slide-btn">Í≤ΩÍ∏∞</button>
                <button class="slide-btn">Í∞ïÏõê</button>
                <button class="slide-btn">Ï∂©Î∂Å</button>
                <button class="slide-btn">Ï∂©ÎÇ®</button>
                <button class="slide-btn">Ï†ÑÎ∂Å</button>
                <button class="slide-btn">Ï†ÑÎÇ®</button>
                <button class="slide-btn">Í≤ΩÎ∂Å</button>
                <button class="slide-btn">Í≤ΩÎÇ®</button>
                <button class="slide-btn">Ï†úÏ£º</button>
            </div>

        </div>

        <div class="logo">
            <div class="logo-child">
            </div>
            <img class="logoo-icon" alt="" src="{% static 'images/Logoo.png' %}">

        </div>
    </div>


    <script>

        /* üëâ URL ÌååÎùºÎØ∏ÌÑ∞Î•º Ïö∞ÏÑ†ÏàúÏúÑ(unit_cd‚Üídist‚Üíq‚Üípage)Î°ú Ïû¨Ï°∞Î¶Ω ---- */
            // ‚≠ê  ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Í≥µÌÜµ Ïú†Ìã∏ Ìï®Ïàò
        function buildUrl(params) {
            const order = ['unit_cd', 'dist', 'q', 'page'];   // Ïö∞ÏÑ†ÏàúÏúÑ
            const parts = [];
            order.forEach(key => {
                if (params.has(key) && params.get(key) !== '') {
                    parts.push(`${key}=${encodeURIComponent(params.get(key))}`);
                }
            });
            return '/?' + parts.join('&');
        }


        /* ------------------------------------------------------------------
           Í≤ÄÏÉâÏ∞Ω, Îã®Ïùº unit_cd Î≤ÑÌäº, Î©îÎâ¥ ÌÜ†Í∏Ä Îì± Í∏∞Ï°¥ Í∏∞Îä•
        ------------------------------------------------------------------ */
        document.addEventListener('DOMContentLoaded', () => {
            const searchBox = document.querySelector('.test');
            const vectorIcon = document.querySelector('.vector-icon');
            const unitButtons = document.querySelectorAll('.div5');
            const params = new URLSearchParams(window.location.search);   // ‚≠ê Ï∂îÍ∞Ä
            const initialQ = params.get('q')?.trim() || '';                // ‚≠ê Ï∂îÍ∞Ä

            /* ‚îÄ‚îÄ (1) ÌéòÏù¥ÏßÄ Ï≤´ Î°úÎìú Ïãú q ÌååÎùºÎØ∏ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Í∑∏ÎåÄÎ°ú ÌëúÏãú ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
            if (initialQ) {
                searchBox.textContent = initialQ;        // Í≤ÄÏÉâÏñ¥ Ïú†ÏßÄ
                searchBox.classList.add('no-placeholder');  // placeholder Ïà®ÍπÄ
            } else {
                searchBox.textContent = '';              // placeholder Î≥¥Ïù¥ÎèÑÎ°ù ÎπÑÏõÄ
                searchBox.classList.remove('no-placeholder');
                searchBox.classList.remove('editing');
            }



            /* üëâ ÌòÑÏû¨ ÏÑ†ÌÉùÎêú unit_cd Î∞òÌôò ---------------------------------- */
            function getCurrentUnitCd() {
                const selectedBtn = document.querySelector('.div5.selected');
                return selectedBtn ? selectedBtn.getAttribute('data-unit') : null;
            }

            
            

            /* üëâ Í≤ÄÏÉâ Ï†úÏ∂ú ----------------------------------------------- */
            function submitSearch() {
                if (!searchBox) return;

                const query = searchBox.textContent.trim();
                if (!query) return;

                /* Í∏∞Ï°¥¬∑ÌòÑÏû¨ URL ÌååÎùºÎØ∏ÌÑ∞ ÏàòÏßë */
                const params = new URLSearchParams(window.location.search);

                /* unit_cdÎäî Í∑∏ÎåÄÎ°ú, distÎèÑ Í∑∏ÎåÄÎ°ú ÎëêÍ≥† page Ï¥àÍ∏∞Ìôî */
                params.delete('q');     // Í∏∞Ï°¥ q Ï†úÍ±∞
                params.delete('page');  // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
                params.set('q', query); // ÏÉà Í≤ÄÏÉâÏñ¥ ÏÇΩÏûÖ

                /* ÏµúÏ¢Ö URL ÏÉùÏÑ± */
                window.location.href = buildUrl(params);  // ‚≠ê ÏàòÏ†ï
            }

            /* vector-icon ÌÅ¥Î¶≠ */
            if (vectorIcon) {
                vectorIcon.addEventListener('click', submitSearch);
            }

            /* Enter ÏûÖÎ†• */
            if (searchBox) {
                searchBox.addEventListener('keydown', e => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        submitSearch();
                    }
                });
            }

            /* unit_cd Î≤ÑÌäº(20¬∑21¬∑22ÎåÄ) Ï≤òÎ¶¨ ------------------------------ */
            const selectedUnit = new URLSearchParams(window.location.search).get('unit_cd');
            unitButtons.forEach(btn => {
                const unitCd = btn.getAttribute('data-unit');
                if (unitCd === selectedUnit) btn.classList.add('selected');

                btn.addEventListener('click', () => {
                    /* unit_cd ÌÅ¥Î¶≠ Ïãú selected ÌÜ†Í∏Ä */
                    unitButtons.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');

                    const params = new URLSearchParams(window.location.search);
                    params.set('unit_cd', unitCd);  // Í∞±Ïã†
                    params.delete('page');          // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
                    /* dist, q Ïú†ÏßÄ */

                    window.location.href = buildUrl(params); // ‚≠ê ÏàòÏ†ï
                });
            });

            /* Í≤ÄÏÉâÏ∞Ω placeholder Ï≤òÎ¶¨ (Í∏∞Ï°¥ Î°úÏßÅ) ------------------------- */
            function placeCaretAtEnd(el) {
                el.focus();
                const range = document.createRange();
                range.selectNodeContents(el);
                range.collapse(false);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }
            function activateEditing() {
                if (searchBox.textContent.trim() === '') searchBox.textContent = '';
                searchBox.classList.add('editing');
                placeCaretAtEnd(searchBox);
            }
            searchBox.addEventListener('click', activateEditing);
            searchBox.addEventListener('focus', activateEditing);
            searchBox.addEventListener('input', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.innerHTML = '';
                    placeCaretAtEnd(searchBox);
                }
            });
            searchBox.addEventListener('blur', () => {
                if (searchBox.textContent.trim() === '') {
                    searchBox.classList.remove('editing');
                    searchBox.textContent = '';
                }
            });
        });

        /* ------------------------------------------------------------------
           Î©îÎâ¥ ÏïÑÏù¥ÏΩò(ÌñÑÎ≤ÑÍ±∞) ÌÜ†Í∏Ä
        ------------------------------------------------------------------ */
        document.addEventListener('DOMContentLoaded', () => {
            const menuIcon = document.querySelector('.menu-icon');
            const menuBox = document.querySelector('.menu-bar');
            const logoIcon = document.querySelector('.logo');

            if (menuIcon && menuBox) {
                menuIcon.addEventListener('click', () => {
                    menuBox.classList.toggle('show');
                    logoIcon.classList.toggle('hidden');
                });
            }

            /* ------------------------------------------------------------------
           slide-btn ÌÅ¥Î¶≠ ‚Üí dist(ÏßÄÏó≠) ÌååÎùºÎØ∏ÌÑ∞ Ï∂îÍ∞Ä
           Ïö∞ÏÑ†ÏàúÏúÑ : unit_cd > dist > q > page
        ------------------------------------------------------------------ */
            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const distVal = button.textContent.trim();

                    const params = new URLSearchParams(window.location.search);
                    params.set('dist', distVal);  // ‚≠ê dist Í∞±Ïã†
                    params.delete('page');        // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî

                    /* ÏµúÏ¢Ö URL Ï°∞Î¶ΩÌïòÏó¨ Ïù¥Îèô */
                    window.location.href = buildUrl(params);  // ‚≠ê buildUrl ÏÇ¨Ïö©
                });
            });

        });

        /* ------------------------------------------------------------------
           ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ® Ïãú Îß® ÏúÑÎ°ú Ïä§ÌÅ¨Î°§
        ------------------------------------------------------------------ */
        window.addEventListener('beforeunload', () => { window.scrollTo(0, 0); });
        window.addEventListener('load', () => { setTimeout(() => window.scrollTo(0, 0), 0); });

        /* ------------------------------------------------------------------
           frame-icon ÌÅ¥Î¶≠ Ïãú slide-btn ÏàúÏ∞® Îì±Ïû•
        ------------------------------------------------------------------ */
        const frameIcon = document.querySelector('.frame-icon');
        const buttons = document.querySelectorAll('.slide-btn');
        let buttonsVisible = false;
        let timeouts = [];

        frameIcon?.addEventListener('click', () => {
            /* Ï§ëÍ∞Ñ ÌÅ¥Î¶≠ Ïãú Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ Ï†úÍ±∞ */
            timeouts.forEach(t => clearTimeout(t));
            timeouts = [];

            if (!buttonsVisible) {
                /* Îì±Ïû• Ïï†ÎãàÎ©îÏù¥ÏÖò */
                buttons.forEach((btn, idx) => {
                    const t = setTimeout(() => btn.classList.add('show'), idx * 50);
                    timeouts.push(t);
                });
            } else {
                /* Ï¶âÏãú ÏÇ¨ÎùºÏßê */
                buttons.forEach(btn => btn.classList.remove('show'));
            }
            buttonsVisible = !buttonsVisible;
        });

    </script>
        


    <script>
        window.addEventListener('load', function () {
            document.body.style.visibility = 'visible';
        });
    </script>

</body>

</html>