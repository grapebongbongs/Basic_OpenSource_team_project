{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>정당 지도 시각화</title>
  <link rel="stylesheet" href="{% static 'css/map.css' %}">
  <script defer src="{% static 'js/map.js' %}"></script>
</head>
<body>
  <div class="div">
    <!-- 상단 배너 -->
    <div class="header">
      {% include 'svg/banner.svg' %}

      <!-- 왼쪽 중앙 텍스트 -->
      <div class="div5">연도별 지역 정당 비율</div>

      <!-- 메뉴 아이콘 및 드롭다운 -->
      <div class="menu-wrapper">
        <div class="menu-icon" onclick="toggleMenu()">
          {% include 'svg/menu.svg' %}
        </div>
        <!-- 드롭다운 메뉴 -->
        <ul class="dropdown-menu hidden" id="menuDropdown">
          <li><a href="/">홈</a></li>
          <li><a href="/about/">소개</a></li>
          <li><a href="/contact/">문의</a></li>
        </ul>
      </div>
    </div>

    <!-- 지도 영역 -->
    <div class="content">
      <div id="map" class="map-container">
        {% include 'svg/korea_map.svg' %}
      </div>

      <!-- 슬라이더 -->
      <div class="slider-wrapper">
        <input type="range" id="daesu-slider" min="10" max="21" value="21">
        <span id="selected-daesu">21대</span>
      </div>
    </div>

    <!-- 상세 지역 정보 -->
    <div id="region-info" class="info-box hidden">
      <h3 id="region-name">지역명</h3>
      <ul id="party-list">
        <li><strong>정당 분포</strong></li>
        <!-- 동적으로 추가될 정당 분포 항목들 -->
      </ul>
      <ul id="rep-list">
        <li><strong>국회의원</strong></li>
        <!-- 동적으로 추가될 국회의원 목록 -->
      </ul>
    </div>

    <script>
      // 메뉴 토글 기능
      function toggleMenu() {
        const menu = document.getElementById('menuDropdown');
        menu.classList.toggle('hidden');
      }

      // 지역 정보 로딩 함수
      function loadRegionData(regionId) {
        const regionInfoBox = document.getElementById('region-info'); // 상세 정보 박스
        const regionName = document.getElementById('region-name');
        const partyList = document.getElementById('party-list');
        const repList = document.getElementById('rep-list');

        // 대수를 사용하여 API 호출
        fetch(`/api/representative-data/?daesu=${regionId}`)
          .then(res => res.json())
          .then(data => {
            // 지역 이름 업데이트
            regionName.textContent = data.regionName;

            // 정당 목록 업데이트
            partyList.innerHTML = '<li><strong>정당 분포</strong></li>';
            data.parties.forEach(party => {
              const li = document.createElement('li');
              li.textContent = `${party.name} - ${party.percentage}%`;
              partyList.appendChild(li);
            });

            // 국회의원 목록 업데이트
            repList.innerHTML = '<li><strong>국회의원</strong></li>';
            data.representatives.forEach(rep => {
              const li = document.createElement('li');
              li.textContent = `${rep.name} (${rep.party})`;
              repList.appendChild(li);
            });

            // 상세 정보 박스를 보여주기
            regionInfoBox.style.display = 'block';
          })
          .catch(err => {
            console.error('지역 데이터 로딩 오류:', err);
          });
      }

      // 페이지 로딩 후 지역 클릭 이벤트 설정
      document.addEventListener('DOMContentLoaded', () => {
        const paths = document.querySelectorAll('#map svg path');
        
        paths.forEach(path => {
          path.addEventListener('click', () => {
            const regionId = path.id;  // 지역의 ID를 가져옵니다.
            console.log('Clicked region:', regionId);
            
            // 슬라이더 대수 값 가져오기
            const daesu = document.getElementById('daesu-slider').value;
            // 클릭한 지역의 정보 로딩
            loadRegionData(daesu, regionId);
          });
        });

        // 슬라이더 변경 시 대수 정보 업데이트
        const slider = document.getElementById('daesu-slider');
        const selectedDaesu = document.getElementById('selected-daesu');
        
        slider.addEventListener('input', () => {
          const daesu = slider.value;  // 슬라이더에서 대수를 가져옴
          selectedDaesu.textContent = `${daesu}대`;
          // 슬라이더 값에 따라 지역 데이터 로드
          const region = document.getElementById('region-name').textContent;
          loadRegionData(daesu, region);  // 대수와 지역을 전달하여 지역 데이터 로드
        });

        // 초기 데이터 로드
        selectedDaesu.textContent = `${slider.value}대`;
        loadRegionData(slider.value, '서울');  // 첫 페이지 로딩 시 기본 지역 '서울'에 대한 데이터 로드
      });
    </script>
  </div>
</body>
</html>
